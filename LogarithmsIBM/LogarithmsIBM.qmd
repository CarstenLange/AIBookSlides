---
title: "Expressing Percentage Change with Logarithms"
subtitle: "What happens if we work with logarimized variables?"
format: 
  revealjs:
    multiplex: true
    code-fold: false
    scrollable: true
    echo: true
    incremental: false
    smaller: false
---

## What Will You Learn {.scrollable .smaller}

```{r}
#| echo: false
library(tidymodels)
library(rio)
library(kableExtra)
library(janitor)

```

-   The difference between absolute and relative (measured in percent) change.
-   How to interpret a regression with a logarithmic *independent* variable
-   How to interpret a regression with a logarithmic *dependent* variable
-   How to interpret a regression with a logarithmic *independent and dependent* variables

# Absolute Change vs. Relative Change {.smaller}

Examples:

1. A stock that you buy for $100 pays you $4 dividend each year. You keep the stock for 5 years and the stock price is still $100

1. A savings account where you deposit $100, pays you 4% interest each year. You keep the stock for 5 years and the stock price is still $100



## Important !!!

### A change of a logarithmic variable can be interpreted as relative (percentage) change

**Example**

```{r}
#| code-fold: true
DataExamp=tibble(t=c(0:3), X=c(200, 203, 207, 200)) |> 
          mutate(TradPercChange=(X-lag(X))/lag(X)) |> 
          mutate(LnX=num(log(X),digits=5)) |> # log calculates the natural logarithm ln() in R 
          mutate(ChangeLnX=LnX - lag(LnX))
print(DataExamp)
```

## Plot MPG \~ Weight

```{r}
#| echo: false
# Data source: https://www.kaggle.com/datasets/uciml/autompg-dataset/
DataAutoMPG=import("https://econ.lange-analytics.com/RData/Datasets/AutoMpg.csv") |>
            clean_names("upper_camel") |> 
            select(MPG=Mpg, Displ=Displacement, Weight) |> 
            mutate(lnMPG=log(MPG), lnDisp=log(Displ), lnWeight=log(Weight))


Plot1=ggplot(DataAutoMPG, aes(x=Weight, y=MPG))+
      geom_point()+
      scale_y_continuous(limits=c(0,50))
Plot2=Plot1+
      geom_smooth(se=FALSE, method="lm", color="blue") 
Plot3=Plot2+
      geom_smooth(se=FALSE, color="red") 
Plot4=ggplot(DataAutoMPG, aes(x=Weight, y=log(MPG)))+
      geom_point()
Plot5=Plot4+
      geom_smooth(se=FALSE, method="lm", color="blue")
```

::::::::: r-stack
::: fragment
```{r}
#| echo: false
plot(Plot1)
```
:::

::: fragment
```{r}
#| echo: false
plot(Plot2)
```
:::

::: fragment
```{r}
#| echo: false
plot(Plot3)
```
:::

::: fragment
```{r}
#| echo: false
plot(Plot1)
```
:::

::: fragment
```{r}
#| echo: false
plot(Plot4)
```
:::

::: fragment
```{r}
#| echo: false
plot(Plot5)
```
:::
:::::::::

## Regression MPG \~ Weight {.smaller}

### No Variable Logarithmized

```{r}

Model1=lm(MPG~Weight, data = DataAutoMPG) 


kbl(tidy(Model1))
kbl(glance(Model1))
```

## Regression LNMPG \~ Weight {.smaller}

### Dependent Variable MPG Logarithmized

```{r}

Model2=lm(log(MPG)~Weight, data=DataAutoMPG) 


kbl(tidy(Model2))
kbl(glance(Model2))
```

## Plot MPG \~ Displ

```{r}
#| echo: false

Plot1=ggplot(DataAutoMPG, aes(x=Displ, y=MPG))+
      geom_point()+
      scale_y_continuous(limits=c(0,50))
Plot2=Plot1+
      geom_smooth(se=FALSE, method="lm", color="blue") 
Plot3=Plot2+
      geom_smooth(se=FALSE, color="red") 
Plot4=ggplot(DataAutoMPG, aes(x=log(Displ), y=MPG))+
      geom_point()
Plot5=Plot4+
      geom_smooth(se=FALSE, method="lm", color="blue")
```

::::::::: r-stack
::: fragment
```{r}
#| echo: false
plot(Plot1)
```
:::

::: fragment
```{r}
#| echo: false
plot(Plot2)
```
:::

::: fragment
```{r}
#| echo: false
plot(Plot3)
```
:::

::: fragment
```{r}
#| echo: false
plot(Plot1)
```
:::

::: fragment
```{r}
#| echo: false
plot(Plot4)
```
:::

::: fragment
```{r}
#| echo: false
plot(Plot5)
```
:::
:::::::::

## Regression MPG \~ Displ {.smaller}

### No Variable Logarithmized

```{r}
Model4=lm(MPG~Displ, data=DataAutoMPG) 

kbl(tidy(Model4))
kbl(glance(Model4))
```

## Regression MPG \~ LNDispl {.smaller}

### Independent Variable Displ Logarithmized

```{r}
Model5=lm(MPG~log(Displ), data=DataAutoMPG) 

kbl(tidy(Model5))
kbl(glance(Model5))
```

## Plot MPG \~ Weight

```{r}
#| echo: false

Plot1=ggplot(DataAutoMPG, aes(x=Weight, y=MPG))+
      geom_point()+
      scale_y_continuous(limits=c(0,50))
Plot2=Plot1+
      geom_smooth(se=FALSE, method="lm", color="blue") 
Plot3=Plot2+
      geom_smooth(se=FALSE, color="red") 
Plot4=ggplot(DataAutoMPG, aes(x=log(Weight), y=log(MPG)))+
      geom_point()
Plot5=Plot4+
      geom_smooth(se=FALSE, method="lm", color="blue")
```

::::::::: r-stack
::: fragment
```{r}
#| echo: false
plot(Plot1)
```
:::

::: fragment
```{r}
#| echo: false
plot(Plot2)
```
:::

::: fragment
```{r}
#| echo: false
plot(Plot3)
```
:::

::: fragment
```{r}
#| echo: false
plot(Plot1)
```
:::

::: fragment
```{r}
#| echo: false
plot(Plot4)
```
:::

::: fragment
```{r}
#| echo: false
plot(Plot5)
```
:::
:::::::::

## Regression MPG \~ Weight {.smaller}

### No Variable Logarithmized

```{r}
Model6=lm(MPG~Weight, data=DataAutoMPG) 

kbl(tidy(Model6))
kbl(glance(Model6))
```

## Regression MPG \~ Weight {.smaller}

### Dependend Variable (MPG) and Independent Variable (Weight) Logarithmized

```{r}
Model7=lm(log(MPG)~log(Weight), data=DataAutoMPG) 

kbl(tidy(Model7))
kbl(glance(Model7))
```

## Summary {visibility="hidden"}

![How to Interpret Regressions With Logarithmic Variables](InterpretLogVarInRegrOverview.png)

Source: <https://quantifyinghealth.com/interpret-log-transformations-in-linear-regression/>

## Interpretation of Regression --- No Transformation {.smaller}

$$Y_i = \beta_1 X_i+ \beta_2 $$ $$\frac{\delta Y}{\delta X}\approx\frac{\Delta Y}{\Delta X}=\beta_1$$ $$\Delta Y=\beta_1\Delta X$$ $\Delta X$: change of $X$,$\Delta Y$: change of $Y$, $\frac{\Delta Y}{\Delta X}$: rise over run.

**The change of** $X$ multiplied with $\beta_1$ equals the change of $Y$.

or

**If** $X$ changes by one unit ($\Delta X=1$), $\Delta Y$ changes by $\beta_1$ units.

## Interpretation of Regression --- Log-Transformation of Dependent Variable {.smaller}

We define a new variable: $LNY=\ln{Y_i}$

$$LNY_i = \beta_1 X_i+ \beta_2 $$ $$\frac{\delta LNY}{\delta X}\approx\frac{\Delta LNY}{\Delta X}=\beta_1$$ $$\Delta LNY=\beta_1\Delta X$$ $\Delta X$: change of $X$,$\Delta LNY$: change of $LNY$, $\frac{\Delta LNY}{\Delta X}$: rise over run.

**The change of** $X$ multiplied with $\beta_1$ equals the change of $LNY$.

$$\Delta LNY=\beta_1\underbrace{\Delta X}_{+1}$$

**Since we know that the change of a logarithm is a relative (percentage) change, we can say: If** $X$ changes by one unit $\Delta X=1$, then $Y$ changes by $\beta_1\cdot 100$%.


