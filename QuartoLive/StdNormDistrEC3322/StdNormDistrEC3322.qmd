---
title: "Standard Deviation and Normal Distribution" 
author:
  name: "Carsten Lange"
  email: "clange@cpp.edu"
  affiliation: "Cal Poly, Pomona"

execute:
  message: false
  warning: false

format: 
  live-revealjs:
    theme: [moon,../../CustomCL.scss]
    warning: false
    controls: true
    chalkboard:
      theme: whiteboard
      boardmarker-width: 2.7
    incremental: false
    scrollable: true
webr:
  packages:
    - tidyverse
    - rio
    - TeachHist
  
  resources: 
    - Data
engine: knitr
---
## What Will You Learn {.scrollable .smaller}


{{< include ../_extensions/r-wasm/live/_knitr.qmd >}}
{{< include ../_extensions/r-wasm/live/_gradethis.qmd >}}
```{r}
#| echo: false
library(TeachHist)

```

-   You will review the concept of *Range*, *Absolute Deviation*, *Variance*, and *Standard Deviation* to measure the spread of a variable.

-   You will review histogram diagrams

-   You will review the concept of *Standard Deviation* to measure the spread of a variable in connection with the Normal Distribution.

-   You will use the *Normal Distribution* to predict individual variables.




## Some Questions to Introduce Center and Spread {.smaller}

::: incremental
-   Who runs faster, men or women?
    -   Is this true for all men and women?
-   Who is taller, men or women?
    -   Is this true for all men and women?
-   What is it the average temperature in Michigan/Coastal California?
    -   Why is the climate different in the two states?
-   Which stock shows higher or lower volatility Procter & Gamble or Nvidia?
    -   Why is that?
    -   Why is it important?
:::

## How to measure Center and Spread {.smaller}

### (1,000 synthetic observations each)

::: columns
::: {.column width="70%"}
```{r}
#| echo: false
library(rio)
library(tidyverse)
DataDerivative=import("Data/DataDerivCryptoEuro.csv")
Plot1=ggplot(DataDerivative, aes(y=1,x=CryptoDeriv))+
       geom_jitter()+
       geom_vline(xintercept = mean(DataDerivative$CryptoDeriv), , color="red", linewidth=2)+
       labs(y="", x="Crypto Derivative in $")+
       scale_x_continuous(limits = c(10,40))+
       scale_y_continuous(labels = NULL)
Plot2=ggplot(DataDerivative, aes(y=1,x=EuroDeriv))+
       geom_jitter()+
       geom_vline(xintercept = mean(DataDerivative$EuroDeriv), , color="red", linewidth=2)+
       labs(y="", x="Euro Derivative in $")+
       scale_x_continuous(limits = c(10,40))+
       scale_y_continuous(labels = NULL) 
Plot1
```

```{r}
#| echo: false
Plot2
```
:::
:::

## How to measure Center and Spread {.smaller}

### (1,000 synthetic observations each)

::: columns
::: {.column width="60%"}
```{r}
#| echo: false
Plot1
```

```{r}
#| echo: false
Plot2
```
:::

::: {.column width="40%"}
$Range=x_{max}-x_{min}$

$AbsDev=\sum_{i=1}^{1000}|x_i-\overline {x}|$

$Var=\sum_{i=1}^{1000}(x_i-\overline {x})^2$

$Std=\sqrt{Var}$

```{r}
RangeCrypto=
  max(DataDerivative$CryptoDeriv)-min(DataDerivative$CryptoDeriv)
MADCrypto=mad(DataDerivative$CryptoDeriv, 
          center=mean(DataDerivative$CryptoDeriv), 
          constant=1)
VarCrypto=var(DataDerivative$CryptoDeriv)
StdCrypto=sd(DataDerivative$CryptoDeriv)

RangeEuro=
  max(DataDerivative$EuroDeriv)-min(DataDerivative$EuroDeriv)
MADEuro=mad(DataDerivative$EuroDeriv, 
          center=mean(DataDerivative$EuroDeriv), 
          constant=1)
VarEuro=var(DataDerivative$EuroDeriv)
StdEuro=sd(DataDerivative$EuroDeriv)
```

**Spread Crypto vs. Euro derivatives:**

Range: `r RangeCrypto` vs. `r RangeEuro`

MAD: `r MADCrypto` vs `r MADEuro`

Var: `r VarCrypto` vs `r VarEuro`

Std: `r StdCrypto` vs `r StdEuro`
:::
:::

## Measuring Female Height Spread for a Small Sample {.smaller}

:::::: columns
::::: {.column width="50%"}
```{r echo=FALSE}
DataSample=data.frame(Height=c(63, 66, 68, 70))
ggplot(DataSample, aes(x=Height, y=c(1:4)))+
  geom_vline(xintercept=mean(DataSample$Height), size=3.7, color="red")+
  geom_point(color="red", size=5)+
  ylab("")+
  scale_x_continuous(breaks=seq(63,70))+
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank(),
        panel.grid.major = element_line(color = "black"),
        panel.grid.minor = element_line(color = "black") 
        )
```

:::::

::::: {.column width="50%"}
:::: {#custom-font-chunk}
```{webr}
#| editor-font-scale: 0.7
#| exercise: ex_1
DataSample=data.frame(Height=c(63, 66, 68, 70))
print(DataSample)
Range=max(______)-min(______)
cat("Range:", Range)
DataResults=DataSample |> 
                        mutate(Deviation=______-mean(Height)) |>
                        mutate(DeviationSq=______)
print(DataResults)
cat("Variance:", sum(DataResults$DeviationSq)/3)
cat("Std. Dev.:", ______(sum(DataResults$DeviationSq)/3))
```

::: {.hint exercise="ex_1"}
<span style="font-size: 0.37em;">Here is a Hint:  
1. Subtract the mean from the column DataSample$Height.  
2. Square each element in the Deviation column. Use Deviation^2  
3. The variance is the sum of the column DeviationSq divided by the sample size minus one.  
4. The Standard Deviation is the square root of the Variance</span>
:::

::: {.solution exercise="ex_1"}
<span style="font-size: 0.37em;">Here is the Solution:</span>

```{webr}
#| exercise: ex_1
#| solution: true
DataSample=data.frame(Height=c(63, 66, 68, 70))
print(DataSample)
Range=max(DataSample$Height)-min(DataSample$Height)
cat("Range:", Range)
DataResults=DataSample |> 
                        mutate(Deviation=Height-mean(Height)) |>
                        mutate(DeviationSq=Deviation^2)
print(DataResults)
cat("Variance:", sum(DataResults$DeviationSq)/3)
cat("Std. Dev.:", sqrt(sum(DataResults$DeviationSq)/3))
```

```{webr}
#| exercise: ex_1
#| check: true
gradethis::grade_this_code()
```


:::

::::
<style>
  /* Target the container and all possible editor types inside it */
  #custom-font-chunk .monaco-editor, 
  #custom-font-chunk .monaco-editor .view-line, 
  #custom-font-chunk .monaco-editor .line-numbers,
  #custom-font-chunk .cm-editor .cm-content,
  #custom-font-chunk .cm-editor .cm-gutterElement {
    font-size: 10px !important;
    line-height: 1.1 !important;
    font-family: monospace !important;
  }

  /* Force the height of the editor box to shrink as well */
  #custom-font-chunk .monaco-editor-background,
  #custom-font-chunk .cm-editor {
    min-height: 100px !important;
  }
</style>

:::::
::::::




## How are Critical Cholesterol Values and other Blood Test Values Determined {.smaller}

**Assumption:** Cholesterol values are *normal distributed.*

**Normal Distribution:**

-   Most values are in the center.
-   Some are larger or smaller than the center.
-   Few are a lot larger or smaller than the center.
-   Very few are extremely large or extremely small
-   The distribution is symmetric around the mean, leading to a bell curve.

For women 45 -- 54 years, the mean is 230.5 mg/100 ml cholesterol, and the standard deviation is 50.0 (source: <https://www.cdc.gov/nchs/data/series/sr_11/sr11_022.pdf>)

## Synthetic Data for 10,000 Women (45 - 54 years) {.smaller}

:::: columns
::: {.column width="55%"}

**Empirical Rule**, also known as the $68-95-99.7$ rule.

```{webr}
library(TeachHist)
TeachHistRelFreq(Mean=230.5, Sd=50, SeedValue=777, NOfSimData=10000)
```


:::

::: {.column width="45%"}
**0.95 Interval:**

- $Mean \pm 2 \cdot StdDev$ 
- In this example $230.5 - 50 \cdot 2= 130.5$ 
- In this example $230.5 + 50\cdot 2= 330.5$ 
- 95% of all 45 - 54 year women have a Cholesterol level higher than 130.5 and lower than 330.5.

:::
::::


## Synthetic Data for 10,000 Women (45 - 54 years)

### Histogram with Relative Frequencies as Column Area and Normal Curve

```{r}
#| echo: false
TeachHistDens(Mean=230.5, Sd=50, SeedValue=777, NOfSimData=10000, PlotNormCurv = TRUE)
```

## Normal Curve {.smaller}

-   Most values are in the center.
-   Some are larger or smaller than the center.
-   Few are a lot larger or smaller than the center.
-   Very few are extremely large or small.
-   The distribution is symmetric around the mean, leading to a bell curve.

$$
Density = \frac{1}{\sqrt{2\pi\sigma^2}} e^{-\frac{(x - \mu)^2}{2\sigma^2}}
$$

where: $\mu$ is the mean and $\sigma$ is the standard deviation

```{r}
#| echo: false
ggplot(data.frame(x = c(30.5, 430.5)), aes(x = x)) +
stat_function(fun = dnorm, args = list(mean = 230.5, sd = 50)) +
labs(title = "Normal Distribution", x = "x", y = "Density")+
scale_x_continuous(breaks=seq(0,450,25))+
geom_vline(xintercept = 230.5, color="red")
```

## Frequentist Statistics {.smaller}

*Frequentist Statistics* uses **Relative Frequency** to estimate **Probability**

**Example:** Mean and Standard Deviation for Throws with a Single Die

```{webr}
set.seed(112)
DataDieThrows=data.frame(Trial=1:10000) |> 
              mutate(Points=sample(1:6, size = 10000, replace=TRUE))
head(DataDieThrows)
cat("Mean:", mean(DataDieThrows$Points))
cat("Std. Dev.:", sd(DataDieThrows$Points))
```

## Histogram with Relative Frequencies (Women's Cholesterol) {.smaller} 

::: columns
::: {.column width="35%"}
**Try:** What is the probability of having a value of less than $200$ when the mean is $230.5$ and the standard deviation is $50$.

`pnorm(x, mean=?, sd=?)` calculates the probability of getting a value smaller than x.

`pnorm4(x, mean=?, sd=?)` does the same but works with the same numbers than your Z-table in the Hawkes textbook and plots a histogram (no warranty!)

:::


::: {.column width="65%"}

```{webr}
#| exercise: ex_2
#| warning: false
#| message: false
source("https://econ.lange-analytics.com/RScripts/ZTable4Digits.R")
cat("Probability for x<200:",
     pnorm(______,______,______))
pnorm4(______,______,______)
```

::: {.hint exercise="ex_2"}
The `pnorm()` and the `pnorm4()` commands have four arguments, the analyzed value, the mean, and the standard deviation (in that order).

:::

::: {.solution exercise="ex_2"}
Here is the Solution:

```{webr}
#| exercise: ex_2
#| solution: true
source("https://econ.lange-analytics.com/RScripts/ZTable4Digits.R")
cat("Probability for x<200:",
     pnorm(200,230.5,50))
pnorm4(200,230.5,50)
```

:::

```{webr}
#| exercise: ex_2
#| check: true
gradethis::grade_this_code()
```

:::
::::

## Histogram with Relative Frequencies as Column Area and Normal Curve {.smaller}

To use the table from the Hawkes textbook, you need to know, how many standard deviation $200$ is from the mean because this is the Z-Value (mean=$230.5$, StdDev=$50$).


:::: columns
::: {.column width="50%"}
```{webr}
#| autorun: true
#| echo: false
#| warning: false
#| message: false
source("https://econ.lange-analytics.com/RScripts/ZTable4Digits.R")
cat("Probability (rounded) for x < 200:")

pnorm4(200, 230.5, 50)
```
:::

::: {.column width="50%"}
```{webr}
#| exercise: ex_3
DistInchesFromMean= ______ - ______
cat("Distance from Mean in Inches:", DistInchesFromMean)
cat("Distance from Mean in Std. Dev:", ______/______)
```

::: {.hint exercise="ex_3"}
Here is a Hint:

To calculate how far 200 is from the mean, subtract the mean from 200.

To find out how many standard deviations the distance above is (z-value), divide by the standard deviation.

$$z=\frac{x-Mean}{StdDev}$$

:::




::: {.solution exercise="ex_3"}
Here is the Solution:

```{webr}
#| exercise: ex_3
#| solution: true
DistInchesFromMean= 200 - 230.5
cat("Distance from Mean in Inches:", DistInchesFromMean)
cat("Distance from Mean in Std. Dev:", DistInchesFromMean/50)
```

:::

```{webr}
#| exercise: ex_3
#| check: true
gradethis::grade_this_code()
```

:::
::::

## Histogram with Relative Frequencies as Column Area and Normal Curve {.smaller}

```{r}
#| echo: false
TeachHistDens(Mean=230.5, Sd=50, SeedValue=777, NOfSimData=10000, PlotNormCurv = TRUE)
```

`pnorm(x, mean=?, sd=?)` calculates the probability of getting a value smaller than x. <br> **Try:** What is the probability of having a value of greater than 360 when the mean is 230.5 and the standard deviation is 50


```{webr}
pnorm(@@@,@@@,@@@)
```

## Histogram with Relative Frequencies as Column Area and Normal Curve {.smaller}

```{r}
#| echo: false
TeachHistDens(Mean=230.5, Sd=50, SeedValue=777, NOfSimData=10000, PlotNormCurv = TRUE)
```

## Histogram with Relative Frequencies as Column Area and Normal Curve {.smaller}

```{r}
#| echo: false
TeachHistDens(Mean=230.5, Sd=50, SeedValue=777, NOfSimData=10000, PlotNormCurv = TRUE)
```

`qnorm(x, mean=?, sd=?)` calculates the value that is not exceeded by x percent of the women<br> **Try:** What is the value that is not exceeded by 95% of women?


```{webr}
qnorm(@@@,@@@,@@@)
```

## Histogram with Relative Frequencies as Column Area and Normal Curve {.smaller}

```{r}
#| echo: false
TeachHistDens(Mean=230.5, Sd=50, SeedValue=777, NOfSimData=10000, PlotNormCurv = TRUE)
```

`qnorm(x, mean=?, sd=?)` calculates the value that is not exceeded by x percent of the women<br> **Try:** Between which values fall 95% of the women (95% confidence interval)


```{webr}
qnorm(@@@,@@@,@@@)
```




## Applications/Exercise {.smaller}

Mean of male height in the U.S. is $70$ inches with a Standard Deviation of 3 inches ([click for source](https://tasks.illustrativemathematics.org/content-standards/tasks/1020#:~:text=The%20heights%20of%20adult%20men,standard%20deviation%20of%202.5%20inches):).

-   What is the probability to randomly meeting an U.S. male with a height smaller than 50 inches assuming height is normal distributed

-   What is the probability to randomly meeting an U.S. male with a height bigger than 80 inches assuming height is normal distributed

-   What is the probability to randomly meeting an U.S. male with a height bigger than 120 inches assuming height is normal distributed

-   What is the probability to randomly meeting an U.S. male with a height between 67 and 73 inches assuming height is normal distributed

-   What is the height range that 95% all men fall in

## Research about Groups (Samples) is Moe Important than Individuals {.smaller}

A group of 50 men are taking a class at Cal Poly. The average height in this class is 72 inches (remember the Mean of all men is $70$ inches and the Standard Deviation is $3$ inches.

. . .

**The mean of the sample is different than the mean of all men.** This should not come as surprise. If we had sampled another class, we would have measured a **different** mean.

. . .

**So, by how much would the *Sample Mean* spread, if we considered more courses?**
<br>
(Note, the spread of a sample mean is called *Standard Error*)

. . .

-   **Standard Error is less than the Standard Deviation of the population** (*mean of men height*). <br> 
**Reason:** In a group, tall and small men partially cancel out.

. . .



. . .

-   The *Standard Error* is smaller when the sample size ($N$) is bigger.






. . .

-   The *Standard Error* is bigger when the *Standard Deviation* of the population is bigger.



. . .

$$SE=\frac{StdDev}{\sqrt{N}}$$



## Back to the Male Students at Cal Poly

A group of 50 men are taking a class at Cal Poly. The average height in this class is 72 inches (remember the Mean of all men is $70$ inches and the Standard Deviation is $3$ inches).

Sample Mean: $\bar x =72$

Standard Error: $SE=\frac{Std}{\sqrt{N}}=\frac{3}{\sqrt{50}}=0.4242641$

```{r}
#| output-location: fragment
RelFreq=1-pnorm(72, mean = 70, sd=0.4242641)
cat("The relative frequency of a group of 50 men  (and thus the probability)  having a mean of 72 inches or taller is", RelFreq)
```

```{r}
#| output-location: fragment
TeachHistHypTest(NullHyp=70,StandardError=3/sqrt(50),
                 SampleMean=72)
```

## Another Application: Mean and Standard Deviation not Known {.smaller}

Our daily sales data for a new product are normally distributed. We do not know the *Mean* nor the *Standard Deviation*.

. . .

However, we have data from the last 36 days to estimate the *Mean* and *Standard Deviation* based on our sample data.

. . .

**Sample Size:** $N=36$

**Estimated Mean in (\$ 1,000):** $\bar x= 90$

**Estimated Standard Deviation:** $StdDev= 12$

**Estimated Standard Error:** $SE= \frac{12}{\sqrt{36}}=2$

## t-Distribution vs. Normal Distribution

**If the Standard Deviation is not known and is estimated from the sample:** <br> Normal Distribution changes to a t-Distribution

**However, Normal Distribution and t-Distribution are very similar with the t-Distribution having fatter tails.**



## t-Distribution vs. Normal Distribution ($N=10$)

```{r}
#| echo: false
DataPlot=data.frame(Sales=seq(90-5*2, 90+5*2, 0.1)) |> 
             mutate(SalesStd=(Sales-90)/2) |> 
             mutate(DensityNorm=dnorm(SalesStd)) |> 
             mutate(DensityT=dt(SalesStd, df=9))

ggplot(DataPlot, aes(x=Sales, y=DensityNorm))+
       geom_line(color="red", linewidth=2)+
       geom_line(aes(x=Sales, y=DensityT), color="blue", linewidth=1)
```

## t-Distribution vs. Normal Distribution ($N=36$)

```{r}
#| echo: false
DataPlot=data.frame(Sales=seq(90-5*2, 90+5*2, 0.1)) |> 
             mutate(SalesStd=(Sales-90)/2) |> 
             mutate(DensityNorm=dnorm(SalesStd)) |> 
             mutate(DensityT=dt(SalesStd, df=35))

ggplot(DataPlot, aes(x=Sales, y=DensityNorm))+
       geom_line(color="red", linewidth=2)+
       geom_line(aes(x=Sales, y=DensityT), color="blue", linewidth=1)
```

## Calculating the 95% Confidence Interval for Mean {.smaller}

```{r}
#| echo: false
set.seed(777)
DataSales=data.frame(Sales=rnorm(36, 90,12))
TeachHistDens(Mean = 90, Sd=2)
```

**Sample Size:** $N=36$
**Estimated Mean in (\$ 1,000):** $\bar x= 90$

**Estimated Standard Deviation:** $StdDev= 12$

**Estimated Standard Error:** $SE= \frac{12}{\sqrt{36}}=2$

Confidence Interval based on `qnorm()`:

```{r}
LowerBound=qnorm(0.025, 90, 2)
UpperBound=qnorm(0.975, 90, 2)
cat("95% Confidence Interval:", LowerBound, UpperBound)
```

. . .

Confidence Interval based on `t.test()`:

```{r}
t.test(DataSales$Sales)
```

## Hypothesis Test

**H0:** Before the sample of 36 days was taken, it was believed that the *Mean* for sales is 85?

**A (Research):** Research of the 36 days suggests that the *Mean* is different $(\bar x=90)$.

. . .

Is the mean from the sample just by accident different from 80 or is there more behind it? The latter would mean the H0 is likely wrong.

. . .

Let us work with 95% *Confidence*.

```{r}
TeachHistHypTest(NullHyp=85, StandardError=2, SampleMean=90, SeedValue=777)
```

