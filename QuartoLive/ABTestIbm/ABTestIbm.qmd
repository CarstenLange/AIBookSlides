---
title: "A/B Test"
subtitle: "The Goldstandard to Assess Treatment Effects in Marketing or Medicine"

author:
  name: "Carsten Lange"
  email: "clange@cpp.edu"
  affiliation: "Cal Poly, Pomona"

execute:
  message: false
  warning: false

format: 
  live-revealjs:
    theme: [moon,../../CustomCL.scss]
    warning: false
    controls: true
    chalkboard:
      theme: whiteboard
      boardmarker-width: 2.7
    incremental: false
    scrollable: true
    footer: "<a href='https://ai.lange-analytics.com/htmlbook/RAndRStudio.html'>Textbook </a> "
webr:
  packages:
    - rio

resources: 
  - Data
    

engine: knitr    
---

{{< include ../_extensions/r-wasm/live/_knitr.qmd >}}



## What Will You Learn

-   How the logic of Treatment and Control leads to *A/B Testing*

-   Requirements for a successful A/B test

-   Possible violations of the requirements of A/BTests and the consequences

-   Post-hoc data analysis as an alternaive to experiments

## A/B-Test

A very powerful and easy to use methodology to compare means of one or more *Treatment groups* to a *Control Group*.

. . .

**Goal:** Determine if a treatment (e.g., number of conversions for a new website (*Treatment*)) leads to significantly better results in the *Treatment Group* compared to the *Control Group* (old website)

. . .

**Methodology:** Two Sample t-Test





## The Idea Behind A/B Tests

### Ideal but not possible: Parallel Universes

![](images/clipboard-2793122789.png)


## Parallel Universes Don't Exist!



![NO Counterfactuals](images/clipboard-2793122789 - NoCounFac.png)

**Problem:** We cannot observe counterfactuals

::: footer
[Source: Samuele Mazzanti, Using Causal ML Instead of A/B Testing, Towards Data Science](https://towardsdatascience.com/using-causal-ml-instead-of-a-b-testing-eeb1067d7fc0){target="_blank"}
:::

## The Idea Behind A/B Tests {.smaller}

### Second Best: Randomly Chosen Subjects

![](images/clipboard-1689822553.png)

If *Treatment* and *Control* group subjects are chosen entirely at random and if we have a large number of subjects, we can assume that any characteristics of subjects that influence the outcome is equally present in *Treatment* and *Control* group (we assume that the red, green, blue, and magenta persons are at least similar when it comes to the outcome)

::: footer
Source: [Samuele Mazzanti, Using Causal ML Instead of A/B Testing, Towards Data Science](https://towardsdatascience.com/using-causal-ml-instead-of-a-b-testing-eeb1067d7fc0){target="_blank"}
:::

## Example: Webdesign in Marketing

### Conversion Data (synthetic) for a New Website Compared to the Original Website

New website is *Treatment* old website is *Control* group

**Purchase value data from the last 100 visitors who purchased on each of the websites:**

```{r}
library(tidyverse)
library(rio)
DataWebSites=import("https://econ.lange-analytics.com/RData/Datasets/DataWebSites.xlsx")
head(DataWebSites)
```

## Mean and Standard Errors for Control and Treatment

**Control Group:**

```{r}
cat("Mean of Control Group is:", mean(DataWebSites$PurchAmtControl))
cat("Standard Error of Control Group is:", sd(DataWebSites$PurchAmtControl)/sqrt(100))
```

. . .

**Treatment Group:**

```{r}
cat("Mean of Treatment Group is:", mean(DataWebSites$PurchAmtTreat))
cat("Standard Error of Treatment Group is:", sd(DataWebSites$PurchAmtTreat)/sqrt(100))
```

## Two Sample t-Test

**Assumption:** Same Variance

**Distribution:** Normal

**Method:**

-   Calculate difference between means

-   Difference between means will also be normal distributed

-   Standard error needs to be recalculated for difference and is approximately double the one of the treatment/control group.

-   **Hypothesis 0:** Difference is 0

-   **Goal:** If Treatment website is better, a difference of 0 should be very unlikely. (we reject the Null Hypothesis as being too unlikely)

## Two Sample t-Test {.smaller}

Here are the first six observations of the data again:

```{r}
#| echo: false
head(DataWebSites)
```



```{webr}
library(rio)
DataWebSites=import("Data/DataWebsites.csv")

t.test(DataWebSites$PurchAmtControl,
       DataWebSites$PurchAmtTreat,
       var.equal=TRUE)
```

## Possible Problems with A/B Testing

### Omitted Variable Bias (Confounders):

Omitting a variable that affects both the Treatment and the Outcome.

![](images/clipboard-3345635073.png){width="485"}

::: footer
Source: [Robson Tigre, Part 1: Simplifying causal inference to connect stakeholders and data scientists, Medium](https://medium.com/@robson.tigre0/part-1-simplifying-causal-inference-to-connect-stakeholders-and-data-scientists-e119856f0f61){target="_blank"}
:::

## Possible Problems with A/B Testing

### Imperfect Compliance and Selection Bias:

Imperfect compliance occurs when not all participants of an experiment adhere to their assigned treatment.

![](images/clipboard-3488515422.png)

::: footer
Source: [Robson Tigre, Part 1: Simplifying causal inference to connect stakeholders and data scientists, Medium](https://medium.com/@robson.tigre0/part-1-simplifying-causal-inference-to-connect-stakeholders-and-data-scientists-e119856f0f61){target="_blank"}
:::

## Possible Problems with A/B Testing {.smaller}

### **Attrition Bias** :

When participants in the Control and Treatment groups leave but the dropout is not balanced (e.g.,unhappy customers leave):

![](images/clipboard-3739776556.png)

::: footer
Source: [Robson Tigre, Part 1: Simplifying causal inference to connect stakeholders and data scientists, Medium](https://medium.com/@robson.tigre0/part-1-simplifying-causal-inference-to-connect-stakeholders-and-data-scientists-e119856f0f61){target="_blank"}
:::

## Possible Problems with A/B Testing  {.smaller}

### Consequences

If biases exist we have to use techniques that can control for these biases, e.g., **Linear Regression**

## Biggest Problems with A/B Testing {.smaller}

**Often we cannot run experiment and have to use existing, post-hoc data**

For example: The relation between lung cancer and second hand smoke in children

. . .

**Existing, post-hoc data  are often biased**

We have to control for these biases, by not only considering the variable of interest (exposure variable) but also control variables. In our example we have to consider:

- second hand smoke(exposure)
- income (control)
- pre-existing conditions (control)
- etc.

**Posible Methedology: Linear Regression**